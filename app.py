# =============================================================================
#  app.py  â€“  Fuel Economy Prediction App
#  Run:  streamlit run app.py
#  Requires: model.pkl (generated by train_model.py)
# =============================================================================

import streamlit as st
import numpy as np
import pickle

st.set_page_config(page_title="Fuel Economy Predictor", page_icon="â›½")

# â”€â”€ Load Model â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
@st.cache_resource
def load_model():
    with open('model.pkl', 'rb') as f:
        return pickle.load(f)

try:
    bundle = load_model()
except FileNotFoundError:
    st.error("model.pkl not found. Please run `python train_model.py` first.")
    st.stop()

scaler      = bundle['scaler']
ridge_model = bundle['ridge_model']

# â”€â”€ UI â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
st.title("â›½ Fuel Economy Predictor")
st.write("Enter your vehicle specifications below to predict fuel economy (MPG).")
st.divider()

col1, col2 = st.columns(2)

with col1:
    cylinders    = st.select_slider("Cylinders", options=[3, 4, 5, 6, 8], value=4)
    displacement = st.number_input("Displacement (cu in)", min_value=68.0,  max_value=455.0, value=150.0, step=5.0)
    horsepower   = st.number_input("Horsepower (hp)",      min_value=46.0,  max_value=230.0, value=100.0, step=5.0)
    weight       = st.number_input("Weight (lbs)",         min_value=1613,  max_value=5140,  value=2500,  step=50)

with col2:
    acceleration = st.number_input("Acceleration (0â€“60 sec)", min_value=8.0, max_value=50.0, value=15.0, step=0.5)
    model_year   = st.slider("Model Year", min_value=1970, max_value=1982, value=1978)
    origin       = st.selectbox("Country of Origin", options=[1, 2, 3],
                                format_func=lambda x: {1: "ðŸ‡ºðŸ‡¸ USA", 2: "ðŸ‡ªðŸ‡º Europe", 3: "ðŸ‡¯ðŸ‡µ Japan"}[x])

st.divider()

# â”€â”€ Predict â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
if st.button("Predict MPG", use_container_width=True, type="primary"):
    input_arr    = np.array([[cylinders, displacement, horsepower,
                               weight, acceleration, model_year - 1900, origin]])
    input_scaled = scaler.transform(input_arr)
    mpg          = ridge_model.predict(input_scaled)[0]

    st.metric(label="Predicted Fuel Economy", value=f"{mpg:.1f} MPG")